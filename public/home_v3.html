<!DOCTYPE html>
<html>


<!--------------------------hv2------------------------------>
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!--  git clone https://github.com/shakir915/hostApkIpa -->
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!-------------------------------------------------------->



<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


  <title id="pafeTile">Welcome</title>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/11.6.0/firebase-app-compat.js"></script>
  <!-- include only the Firebase features as you need -->
  <!--    <script defer src="/__/firebase/9.15.0/firebase-auth-compat.js"></script>-->
  <script defer src="/__/firebase/11.6.0/firebase-database-compat.js"></script>
  <!--    <script defer src="/__/firebase/9.15.0/firebase-firestore-compat.js"></script>-->
  <!--    <script defer src="/__/firebase/9.15.0/firebase-functions-compat.js"></script>-->
  <!--    <script defer src="/__/firebase/9.15.0/firebase-messaging-compat.js"></script>-->
  <!--<script defer src="/__/firebase/9.15.0/firebase-storage-compat.js"></script>-->
  <script defer src="/__/firebase/11.6.0/firebase-analytics-compat.js"></script>
  <!--    <script defer src="/__/firebase/9.15.0/firebase-remote-config-compat.js"></script>-->
  <!--    <script defer src="/__/firebase/9.15.0/firebase-performance-compat.js"></script>-->
  <!--
    initialize the SDK after all desired features are loaded, set useEmulator to false
    to avoid connecting the SDK to running emulators.
  -->
  <script defer src="/__/firebase/init.js?useEmulator=true"></script>
  <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>


  <style media="screen">
    body {
      background: #1a1a1a;
      color: rgba(255, 255, 255, 0.87);
      font-family: "Quicksand", sans-serif;
      margin: 0;
      padding: 0;

    }

    #message {
      background: #2d2d2d;
      max-width: 275px;
      margin: 100px auto 16px;
      margin-top: 50px;
      padding-top: 0px;
      padding-left: 32px;
      padding-right: 32px;
      padding-bottom: 16px;
      padding: 32px 24px;
      border-radius: 3px;
    }

    #message h1 {
      color: #ffa100;
      font-weight: 300;
      font-size: 22px;
      margin: 0 0 8px;
    }

    #message h2 {
      font-size: 12px;
      font-weight: 100;
      color: rgba(255, 255, 255, 0.6);
      margin: 0 0 16px;
    }

    #message p {
      line-height: 140%;
      margin: 16px 0 24px;
      font-size: 14px;
    }

    #message a {
      display: block;
      text-align: center;
      background: #039be5;
      text-decoration: none;
      color: white;
      padding: 7px;
      border-radius: 2px;
    }

    #message,
    #message a {
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
    }

    #load {
      color: rgba(255, 255, 255, 0.3);
      text-align: center;
      font-size: 11px;
    }

    @media (max-width: 600px) {

      body,
      #message {
        margin-top: 0;
        background: #2d2d2d;
        box-shadow: none;
      }

      body {
        border-top: 0px solid #ffa100;
        background: #1a1a1a;
      }
    }


    .btn {
      background-color: DodgerBlue;
      border: none;
      color: white;

      font-size: 16px;
      cursor: pointer;
    }

    /* Darker background on mouse-over */
    .btn:hover {
      background-color: RoyalBlue;
    }


    .centerIMG {
      display: block;
      margin-left: auto;
      margin-right: auto;
      width: 30%;
    }

    a.upload {
      font-size: 14px;
      display: table;
      align-items: center;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
      text-decoration: none;
      visibility: hidden;
      color: #66b3ff;
      cursor: pointer;


    }

    #qrcode {

      align-items: center;
      text-align: center;
      margin-left: auto;
      margin-right: auto;

      padding-left: 30px;
      padding-top: 10px;
      padding-bottom: 10px;
    }

    #qrText {

      align-items: center;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
      font-size: 10px;
    }
  </style>
</head>

<body>
  <div id="message">
    <!-- <h2 id="urlid"></h2> -->

    <h1 id="appid">Loading...</h1>



    <div id="qrcode"></div>
    <div id="qrText"></div>

    <div id="result_div_icon" style="padding-top: 10px; padding-bottom: 10px;"> </div>
    <div id="result_list_packageName"></div>
    <div id="result_list_versionName"></div>
    <div id="result_list_date"></div>
    <div>
      <span id="infoButton"
        style="display: none; color: #66b3ff; text-align: right; width: 100px; font-weight: 100; padding-right: 20px;font-size: 14px; cursor: pointer; "
        onclick="viewJsonInNewTab()">More Info</span>
    </div>

    <p id="instruction1"></p>
    <div id="result_list_ios"></div>
    <p> </p>
    <div id="result_list_android"> </div>









  </div>

  <a class="upload" id="upload">Upload New App </a>
  <script type="text/javascript">

    let lastFetchTime = 0;
    const COOLDOWN_PERIOD = 5 * 1000;
    var g_app_name_for_url = null;


    async function refreshRedirection() {
      if (window.location.href.includes("localhost") || window.location.href.startsWith("file:///")) {
        return; // Exit the function without fetching
      }
      const response = await fetch("https://install4-default-rtdb.asia-southeast1.firebasedatabase.app/redirection.json");
      const new_redirection = await response.json();
      // console.log(new_redirection);
      var old_redirection = localStorage.getItem('redirection');
      localStorage.setItem('redirection', new_redirection);
      // console.log("old_redirection $old_redirection new_redirection $new_redirection");

      var pageID = window.location.toString().split("/").slice(-1)[0].replace("#", "");


      if ((pageID == null || pageID.trim() == "" || pageID.toLowerCase() == "upload") && pageID != "events" && pageID != "events.html" && new_redirection != null && new_redirection.trim != "" && !window.location.href.includes("g_url_id") && !window.location.href.includes("localhost") && window.location.href != new_redirection) {
        window.location = new_redirection;
      }

    }


    refreshRedirection();

    document.getElementById("upload").onclick = function () {
      var redirection = localStorage.getItem('redirection');
      window.open(redirection, '_blank');
    };
  </script>


  <p id="load">Firebase SDK Loading&hellip;</p>

  <script>
    try {
      var k = new Map();
      // console.log("ES6 supported!!");
    } catch (err) {
      window.location = "./es5_redirect.html?id=" + window.location.toString().split("/").slice(-1)[0].replace("#", "");
      //return;
    }

  </script>


  <script>
    var pageID = null
    var deviceType = 0;


    document.addEventListener('DOMContentLoaded', function () {

      //console.log(navigator.userAgent)

      pageID = window.location.toString().split("/").slice(-1)[0].replace("#", "");
      if (pageID.toLocaleLowerCase() == "events") {
        window.location = "./events.html";
        return
      }








      try {

        var ref = firebase.database().ref("/events")
        var newChildRef = ref.push();
        newChildRef.set({
          "page": pageID,
          "time": Date.now(),
          "action": "open",
          "userAgent": navigator.userAgent

        });
      } catch (e) {
        console.error(e);

      }

      if (pageID.startsWith("video_")) {
        window.location = "https://www.youtube.com/watch?v=" + pageID.replace("video_", "");
        return
      }





      const appid = document.querySelector('#appid');
      const packageName = document.querySelector('#packageName');

      //const urlid = document.querySelector('#urlid');
      const pafeTile = document.querySelector('#pafeTile');
      const iosdlink2 = document.querySelector('#iosdlink2');


      //urlid.textContent = pageID;
      pafeTile.textContent = pageID;

      const loadEl = document.querySelector('#load');
      const instruction1 = document.querySelector('#instruction1');

      // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
      // // The Firebase SDK is initialized and available here!
      //
      // firebase.auth().onAuthStateChanged(user => { });






      try {
        if (navigator.maxTouchPoints &&
          navigator.maxTouchPoints > 2 &&
          /MacIntel/.test(navigator.platform)) {
          deviceType = 2; //ipad workaround
        }
      } catch (error) {

      }














      try {
        var userAgent = navigator.userAgent
        if (/android/i.test(userAgent)) {
          deviceType = 1;
        }
      } catch (error) {

      }




      // iOS detection from: http://stackoverflow.com/a/9039885/177710
      if (/iPad|iPhone|iPod/.test(userAgent)) {
        deviceType = 2;
      }
      console.log('deviceType ', deviceType)










      try {
        firebase
        //use rest api if firebase undefined
        // Uncaught ReferenceError: firebase is not defined 
      } catch (error) {
        console.log(error)
        window.location = "./es5_redirect.html?id=" + window.location.toString().split("/").slice(-1)[0].replace("#", "");


      }


      fetchData()


      document.addEventListener('visibilitychange', function () {
        if (document.visibilityState === 'visible') {
          fetchData()
        }
      });

      window.addEventListener('focus', function () {
        fetchData()
      });
      window.addEventListener('blur', function () {
        fetchData()
      });



      try {
        let app = firebase.app();
        let features = [
          // 'auth',
          'database',
          // 'firestore',
          // 'functions',
          // 'messaging',
          //          'storage',
          'analytics',
          // 'remoteConfig',
          // 'performance',
        ].filter(feature => typeof app[feature] === 'function');
        loadEl.textContent = "";//window.location.hostname + ` by Shakir`;



      } catch (e) {
        console.error(e);
        loadEl.textContent = 'Error loading the Firebase SDK';
      }
    });






    function download1(url, action) {


      const a = document.createElement('a')
      a.href = url
      a.download = url.split('/').pop()
      document.body.appendChild(a)
      a.click()
      document.body.removeChild(a)

      try {
        var ref = firebase.database().ref("/events")
        var newChildRef = ref.push();
        newChildRef.set({
          "page": pageID,
          "time": Date.now(),
          "action": action
        });
      } catch (e) {
        console.error(e);

      }
    }

    async function viewJsonInNewTab() {

      let ios = null;
      let android = null;

      try {
        const snapshot = await firebase.database().ref("/more_details/ios/" + pageID).once("value");
        const jsonString = snapshot.val();
        if (jsonString) {
          ios = JSON.parse(jsonString);
        }
      } catch (e) {
        console.error("Error fetching iOS data:", e);
      }

      try {
        const snapshot = await firebase.database().ref("/more_details/android/" + pageID).once("value");
        const jsonString = snapshot.val();
        if (jsonString) {
          android = JSON.parse(jsonString);
        }
      } catch (e) {
        console.error("Error fetching Android data:", e);
      }

      localStorage.removeItem("hd_time");
      localStorage.removeItem("jsonStore_1");
      localStorage.removeItem("jsonStore_2");
      if (android != null)
        localStorage.setItem("jsonStore_2", encodeURIComponent(JSON.stringify(android, null, 2)));
      if (ios != null)
        localStorage.setItem("jsonStore_1", encodeURIComponent(JSON.stringify(ios, null, 2)));
      localStorage.setItem("g_app_name_for_url", g_app_name_for_url);
      try {
        const newTab = window.open(`more_info.html`, '_blank');
        if (newTab) {
          newTab.focus();
        } else {
          // If popup blocked, open in same tab instead of showing alert
          window.location.href = `more_info.html`;
        }
      } catch (e) {
        // Fallback for any errors
        window.location.href = `more_info.html`;
      }

    }


    function clearElementContent(elementId) {
      try {
        const element = document.getElementById(elementId);
        if (element) {
          while (element.firstChild) {
            element.removeChild(element.firstChild);
          }
        }
      }
      catch (e) {

      }

    }


    function getSafeDataDupRemoved(data, name) {
      var iosData = null;
      var androidData = null;
      try { iosData = data["ios"][name] } catch (e) { console.error(e); }
      try { androidData = data["android"][name] } catch (e) { console.error(e); }
      if (iosData !== null && androidData !== null && iosData !== androidData) {
        return `${iosData} | ${androidData}`;
      } else if (iosData !== null) {
        return iosData;
      } else if (androidData !== null && iosData == null) {
        return androidData;
      }
      return null;
    }

    function getSafeDateTime(data, name) {

      var iosData = null;
      var androidData = null;
      try { iosData = new Date(data["ios"][name]).toDateString(); } catch (e) { console.error(e); }
      try { androidData = new Date(data["android"][name]).toDateString(); } catch (e) { console.error(e); }
      if (androidData !== null && deviceType == 1) {
        return androidData;
      }
      if (iosData !== null) {
        return iosData;
      }
      return androidData;
    }


    function getSafeDataIosFirst(data, name) {
      var iosData = null;
      var androidData = null;
      try { iosData = data["ios"][name] } catch (e) { console.error(e); }
      try { androidData = data["android"][name] } catch (e) { console.error(e); }
      if (deviceType == 1) {
        if (androidData !== null) {
          return androidData;
        } else return iosData;
      }
      if (iosData !== null) {
        return iosData;
      } else return androidData;
    }

    function hasDataOn(data, name, platform) {
      try {
        const cData = data[platform]?.[name];
        return typeof cData === "string" && cData.trim() !== "";
      } catch (e) {
        console.error(e);
        return false;
      }
    }



    function setData(data) {
      g_app_name_for_url = getSafeDataIosFirst(data, "g_app_name_for_url");
      appid.textContent = getSafeDataIosFirst(data, "name");
      var div = document.createElement('div')
      div.innerHTML = `<span style="color: rgba(255, 255, 255, 0.87); text-align: right; width: 100px; font-weight: 100; padding-right: 20px;font-size: 14px;">${getSafeDataIosFirst(data, "packageName")}</span>`
      clearElementContent('result_list_packageName')
      document.getElementById('result_list_packageName').appendChild(div)
      document.getElementById("infoButton").style.display = "inline";
      div = document.createElement('div')
      div.innerHTML = `<span style="color: rgba(255, 255, 255, 0.87); text-align: right; width: 100px; font-weight: 400; padding-right: 20px;font-size: 14px;">Version: ${getSafeDataIosFirst(data, "versionName")}</span>`
      clearElementContent('result_list_versionName')
      document.getElementById('result_list_versionName').appendChild(div)
      div = document.createElement('div')
      div.innerHTML = `<span style="color: rgba(255, 255, 255, 0.87); text-align: right; width: 100px; font-weight: 100; padding-right: 20px;font-size: 14px;">Uploaded: ${getSafeDateTime(data, "date")}</span>`
      clearElementContent('result_list_date')
      document.getElementById('result_list_date').appendChild(div)
      div = document.createElement('div')
      
      var imagedata = getSafeDataIosFirst(data, "icon");
      if (imagedata == null || imagedata === "") {
        if (data && data.ios && data.ios.icon) {
          imagedata = data.ios.icon;
        }
      }
      if (imagedata == null || imagedata === "") {
        if (data && data.android && data.android.icon) {
          imagedata = data.android.icon;
        }
      }
      if (imagedata != null && imagedata !== "") {
        div.innerHTML = `<img src="${imagedata}" class="centerIMG">`;
      }

      clearElementContent('result_div_icon')
      document.getElementById('result_div_icon').appendChild(div)
      if ((deviceType == 2) && hasDataOn(data, "plist", "ios")) {
        var linkkkk = "itms-services://?action=download-manifest&url=";
        let encoded = encodeURIComponent(data["ios"]["plist"]);
        const div = document.createElement('div')
        div.innerHTML = `<a   onClick="download1(\'${linkkkk + encoded}\',\'download_plist\')" class="btn"><i class="fa fa-apple" style="font-size:18px;color:white" ></i>  Download</a>`
        clearElementContent('result_list_ios')
        document.getElementById('result_list_ios').appendChild(div)
      }
      if ((deviceType == 0) && hasDataOn(data, "ipa", "ios")) {
        const div = document.createElement('div')
        div.innerHTML = `<a       onClick="download1(\'${data["ios"]["ipa"]}\',\'download_ipa\')"   class="btn"><i class="fa fa-apple" style="font-size:18px;color:white" ></i>  Download</a>`
        clearElementContent('result_list_ios')
        document.getElementById('result_list_ios').appendChild(div)
      }
      if ((deviceType == 1 || deviceType != 2) && hasDataOn(data, "apk", "android")) {
        const div = document.createElement('div')
        div.innerHTML = `<a onClick="download1(\'${data["android"]["apk"]}\',\'download_apk\')"  class="btn"><i class="fa fa-android" style="font-size:18px;color:white" ></i>  Download</a>`
        clearElementContent('result_list_android')
        document.getElementById('result_list_android').appendChild(div)
      }
      if (deviceType == 0) {
        clearElementContent('qrcode');
        const qrcode = new QRCode(document.getElementById('qrcode'), {
          text: window.location.toString(),
          width: 200,
          height: 200,
          colorDark: '#fff',
          colorLight: '#2d2d2d',
          correctLevel: QRCode.CorrectLevel.H
        });
        const qrText = document.querySelector('#qrText');
        qrText.textContent = "scan QR code to install in your phone";
      }
    }



    async function fetchData() {
      const currentTime = Date.now();
      if (currentTime - lastFetchTime < COOLDOWN_PERIOD) {
        return;
      }
      lastFetchTime = currentTime;
      appid.textContent = "Loading...";
      const paths = ["/app_links/" + pageID, ("/app_links_all/" + pageID).replace("____", "/")];

      for (const path of paths) {
        //  console.log(path)
        try {
          const snapshot = await firebase.database().ref(path).get();
          if (snapshot.exists()) {
            let data = {};
            snapshot.forEach(function (childSnapshot) {
              var childKey = childSnapshot.key;
              var childData = childSnapshot.val();
              data[childKey] = childData;
            });
            //  console.log(path)
            // console.log(data)
            if (hasDataOn(data, "ipa", "ios") || hasDataOn(data, "apk", "android")) {
              setData(data)
              document.getElementById("upload").style.visibility = 'visible';
              return
            }
          }
        } catch (error) {
          console.error(`Error fetching data from ${path + pageID}:`, error);
        }
      }

      appid.textContent = "404 Not Found";

    }


  </script>
</body>

</html>