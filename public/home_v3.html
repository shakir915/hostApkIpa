<!DOCTYPE html>
<html>


<!--------------------------hv2------------------------------>
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!--  git clone https://github.com/shakir915/hostApkIpa -->
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!-------------------------------------------------------->
<!-------------------------------------------------------->



<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">


  <title id="pafeTile">Welcome</title>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/11.6.0/firebase-app-compat.js"></script>
  <!-- include only the Firebase features as you need -->
  <!--    <script defer src="/__/firebase/9.15.0/firebase-auth-compat.js"></script>-->
  <script defer src="/__/firebase/11.6.0/firebase-database-compat.js"></script>
  <!--    <script defer src="/__/firebase/9.15.0/firebase-firestore-compat.js"></script>-->
  <!--    <script defer src="/__/firebase/9.15.0/firebase-functions-compat.js"></script>-->
  <!--    <script defer src="/__/firebase/9.15.0/firebase-messaging-compat.js"></script>-->
  <!--<script defer src="/__/firebase/9.15.0/firebase-storage-compat.js"></script>-->
  <script defer src="/__/firebase/11.6.0/firebase-analytics-compat.js"></script>
  <!--    <script defer src="/__/firebase/9.15.0/firebase-remote-config-compat.js"></script>-->
  <!--    <script defer src="/__/firebase/9.15.0/firebase-performance-compat.js"></script>-->
  <!--
    initialize the SDK after all desired features are loaded, set useEmulator to false
    to avoid connecting the SDK to running emulators.
  -->
  <script defer src="/__/firebase/init.js?useEmulator=true"></script>
  <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>


  <style media="screen">
    body {
      background: #1a1a1a;
      color: rgba(255, 255, 255, 0.87);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      margin: 0;
      padding: 0;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-weight: 400;
    }

    #message {
      background: #2d2d2d;
      max-width: 275px;
      margin: 100px auto 16px;
      margin-top: 50px;
      padding-top: 0px;
      padding-left: 32px;
      padding-right: 32px;
      padding-bottom: 16px;
      padding: 32px 24px;
      border-radius: 3px;
    }

    #message h1 {
      color: #ffa100;
      font-weight: 300;
      font-size: 33px;
      margin: 0 0 8px;
    }

    #message h2 {
      font-size: 12px;
      font-weight: 100;
      color: rgba(255, 255, 255, 0.6);
      margin: 0 0 16px;
    }

    #message p {
      line-height: 140%;
      margin: 16px 0 24px;
      font-size: 14px;
    }

    #message a {
      display: block;
      text-align: center;
      background: #039be5;
      text-decoration: none;
      color: white;
      padding: 7px;
      border-radius: 2px;
    }

    #message,
    #message a {
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
    }

    #load {
      color: rgba(255, 255, 255, 0.3);
      text-align: center;
      font-size: 11px;
    }

    @media (max-width: 600px) {

      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0;
        padding: 20px 16px 0 16px;
        border-top: 0px solid #ffa100;
        background: #1a1a1a;
        overflow-x: hidden;
        box-sizing: border-box;
        min-height: 100vh;
      }

      #message {
        margin: 0;
        width: 100%;
        max-width: none;
        background: #2d2d2d;
        box-shadow: none;
        box-sizing: border-box;
        padding: 24px 20px;
        border-radius: 8px;
      }

      .upload {
        margin-top: 24px;
        width: 100%;
        max-width: 280px;
        padding: 12px 16px;
        font-size: 16px;
        border-radius: 8px;
        text-align: center;
        box-sizing: border-box;
      }

      #qrcode {
        padding: 20px 0;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #qrText {
        margin-top: 12px;
        font-size: 12px;
        line-height: 1.4;
        padding: 0 10px;
        text-align: center;
      }

      .centerIMG {
        width: 80px;
        height: 80px;
        border-radius: 12px;
        object-fit: cover;
        aspect-ratio: 1 / 1;
      }

      .btn {
        width: 100%;
        padding: 16px 20px;
        font-size: 18px;
        border-radius: 8px;
        margin-bottom: 12px;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        box-sizing: border-box;
        transition: all 0.3s ease;
      }

      .btn:active {
        transform: scale(0.98);
      }

      #result_list_packageName,
      #result_list_versionName,
      #result_list_date {
        margin-bottom: 6px;
      }

      #result_list_packageName span,
      #result_list_versionName span,
      #result_list_date span {
        font-size: 14px;
        padding: 0;
        text-align: left;
        display: block;
        width: 100%;
        word-break: break-word;
        padding-right: 0;
      }

      #infoButton {
        width: 100%;
        text-align: center;
        padding: 12px 0;
        font-size: 16px;
        display: block;
        margin-top: 12px;
      }

      #load {
        padding: 20px 0;
        font-size: 12px;
      }

      #appid {
        font-size: 36px;
        margin-bottom: 16px;
        text-align: center;
        word-break: break-word;
      }

      #result_div_icon {
        text-align: center;
        padding: 20px 0;
      }

      #result_list_packageName {
        margin-top: 16px;
      }
    }


    .btn {
      background-color: DodgerBlue;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      padding: 12px 16px;
      border-radius: 6px;
      text-decoration: none;
      display: inline-block;
      transition: background-color 0.3s ease;
      min-height: 44px;
      box-sizing: border-box;
    }

    /* Darker background on mouse-over */
    .btn:hover {
      background-color: RoyalBlue;
    }


    .centerIMG {
      display: block;
      margin-left: auto;
      margin-right: auto;
      width: 100px;
      height: 100px;
      object-fit: cover;
      aspect-ratio: 1 / 1;
      border-radius: 16px;
    }

    a.upload {
      font-size: 14px;
      display: table;
      align-items: center;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
      text-decoration: none;
      visibility: hidden;
      color: #66b3ff;
      cursor: pointer;


    }

    #qrcode {
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
      padding-top: 10px;
      padding-bottom: 10px;
    }

    #qrText {

      align-items: center;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
      font-size: 10px;
    }
  </style>
</head>

<body>
  <div id="message">
    <!-- <h2 id="urlid"></h2> -->

    <h1 id="appid"></h1>



    <div id="qrcode"></div>
    <div id="qrText"></div>

    <div id="result_div_icon" style="padding-top: 10px; padding-bottom: 10px;"> </div>
    <div id="result_list_packageName"></div>
    <div id="result_list_versionName"></div>
    <div id="result_list_date"></div>
    <div>
      <span id="infoButton"
        style="display: none; color: #66b3ff; text-align: right; width: 100px; font-weight: 100; padding-right: 20px;font-size: 14px; cursor: pointer; "
        onclick="viewJsonInNewTab()">More Info</span>
    </div>

    <p id="instruction1"></p>
    <div id="result_list_ios"></div>
    <p> </p>
    <div id="result_list_android"> </div>









  </div>

  <a class="upload" id="upload">Upload New App </a>
  <script type="text/javascript">

    let lastFetchTime = 0;
    const COOLDOWN_PERIOD = 5 * 1000;
    var g_app_name_for_url = null;

    const loadingWords = ["Loading..."]

    // IP Tracking Function
    async function trackIPData(action) {
      try {

        const response222 = await fetch('https://httpbin.org/headers', {
          referrerPolicy: 'no-referrer', // Removes Referer header completely,
        });
        const data = await response222.json();
        console.log(data.headers);

        // Fetch IP data from pro.ip-api.com
        const response = await fetch('https://pro.ip-api.com/json?key=yjfBZPLkt6Kkl3h&fields=58335');
        const ipData = await response.json();

        // Add timestamp and user agent
        ipData.pageID = pageID;
        ipData.timestamp = Date.now();
        ipData.userAgent = navigator.userAgent;
        ipData.action = action;

        // Save to Firebase at ip_details/g_url_id/
        const ref = firebase.database().ref("/ip_details/" + g_app_name_for_url);
        const newChildRef = ref.push();
        await newChildRef.set(ipData);

        console.log('IP tracking saved:', action);
      } catch (e) {
        console.error('Error tracking IP data:', e);
      }
    }

    function getRandomLoadingWord() {
      return loadingWords[Math.floor(Math.random() * loadingWords.length)] + "...";
    }


    async function refreshRedirection() {
      if (window.location.href.includes("localhost") || window.location.href.startsWith("file:///")) {
        return; // Exit the function without fetching
      }
      const response = await fetch("https://install4-default-rtdb.asia-southeast1.firebasedatabase.app/redirection.json");
      const new_redirection = await response.json();
      // console.log(new_redirection);
      var old_redirection = localStorage.getItem('redirection');
      localStorage.setItem('redirection', new_redirection);
      // console.log("old_redirection $old_redirection new_redirection $new_redirection");

      var pageID = window.location.toString().split("/").slice(-1)[0].replace("#", "");


      if ((pageID == null || pageID.trim() == "" || pageID.toLowerCase() == "upload") && pageID != "events" && pageID != "events.html" && new_redirection != null && new_redirection.trim != "" && !window.location.href.includes("g_url_id") && !window.location.href.includes("localhost") && window.location.href != new_redirection) {
        window.location = new_redirection;
      }

    }


    refreshRedirection();

    document.getElementById("upload").onclick = function () {
      var redirection = localStorage.getItem('redirection');
      window.location.href = redirection;
    };
  </script>


  <p id="load">Firebase SDK Loading&hellip;</p>
  <div id="storageAccess" style="color: red; text-align: center; font-size: 12px; margin-top: 10px; display: none;">
  </div>

  <script>
    try {
      var k = new Map();
      // console.log("ES6 supported!!");
    } catch (err) {
      window.location = "./es5_redirect.html?id=" + window.location.toString().split("/").slice(-1)[0].replace("#", "");
      //return;
    }

  </script>


  <script>
    var pageID = null
    var deviceType = 0;


    document.addEventListener('DOMContentLoaded', function () {

      //console.log(navigator.userAgent)

      pageID = window.location.toString().split("/").slice(-1)[0].replace("#", "");
      if (pageID.toLocaleLowerCase() == "events") {
        window.location = "./events.html";
        return
      }








      try {

        var ref = firebase.database().ref("/events")
        var newChildRef = ref.push();
        newChildRef.set({
          "page": pageID,
          "time": Date.now(),
          "action": "open",
          "userAgent": navigator.userAgent

        });

        // Track IP data on page open
        // trackIPData("page_open");

      } catch (e) {
        console.error(e);

      }

      if (pageID.startsWith("video_")) {
        window.location = "https://www.youtube.com/watch?v=" + pageID.replace("video_", "");
        return
      }





      const appid = document.querySelector('#appid');
      const packageName = document.querySelector('#packageName');

      //const urlid = document.querySelector('#urlid');
      const pafeTile = document.querySelector('#pafeTile');
      const iosdlink2 = document.querySelector('#iosdlink2');


      //urlid.textContent = pageID;
      pafeTile.textContent = pageID;
      appid.textContent = getRandomLoadingWord();

      const loadEl = document.querySelector('#load');
      const instruction1 = document.querySelector('#instruction1');

      // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
      // // The Firebase SDK is initialized and available here!
      //
      // firebase.auth().onAuthStateChanged(user => { });






      try {
        if (navigator.maxTouchPoints &&
          navigator.maxTouchPoints > 2 &&
          /MacIntel/.test(navigator.platform)) {
          deviceType = 2; //ipad workaround
        }
      } catch (error) {

      }














      try {
        var userAgent = navigator.userAgent
        if (/android/i.test(userAgent)) {
          deviceType = 1;
        }
      } catch (error) {

      }




      // iOS detection from: http://stackoverflow.com/a/9039885/177710
      if (/iPad|iPhone|iPod/.test(userAgent)) {
        deviceType = 2;
      }
      console.log('deviceType ', deviceType)










      try {
        firebase
        //use rest api if firebase undefined
        // Uncaught ReferenceError: firebase is not defined 
      } catch (error) {
        console.log(error)
        window.location = "./es5_redirect.html?id=" + window.location.toString().split("/").slice(-1)[0].replace("#", "");


      }


      fetchData()

      // Check Firebase Storage access and show/hide message
      checkFirebaseStorageAccess().then(hasAccess => {
        const storageAccessElement = document.getElementById('storageAccess');
        if (!hasAccess) {
          storageAccessElement.innerHTML = `no access to firebase storage : <a href="https://firebase.google.com/docs/storage/faqs-storage-changes-announced-sept-2024?authuser=0&_gl=1*1s56cyb*_ga*MjExNDU2NDQ2Ny4xNzIxOTg2MjAx*_ga_CW55HF8NVT*czE3NTg4MTAxMTUkbzQ0MSRnMSR0MTc1ODgxMDQwNCRqMzckbDAkaDA.#:~:text=pricing%20plan%20by-,October%201%2C%202025),-." target="_blank" style="color: red;">Learn more</a>`;
          storageAccessElement.style.display = 'block';
        } else {
          storageAccessElement.style.display = 'none';
        }
      }).catch(error => {
        console.error("Error checking Firebase Storage access:", error);
      });

      document.addEventListener('visibilitychange', function () {
        if (document.visibilityState === 'visible') {
          fetchData()
        }
      });

      window.addEventListener('focus', function () {
        fetchData()
      });
      window.addEventListener('blur', function () {
        fetchData()
      });



      try {
        let app = firebase.app();
        let features = [
          // 'auth',
          'database',
          // 'firestore',
          // 'functions',
          // 'messaging',
          //          'storage',
          'analytics',
          // 'remoteConfig',
          // 'performance',
        ].filter(feature => typeof app[feature] === 'function');
        loadEl.textContent = "";//window.location.hostname + ` by Shakir`;



      } catch (e) {
        console.error(e);
        loadEl.textContent = 'Error loading the Firebase SDK';
      }
    });






    function download1(url, action) {


      const a = document.createElement('a')
      a.href = url
      a.download = url.split('/').pop()
      document.body.appendChild(a)
      a.click()
      document.body.removeChild(a)

      try {
        var ref = firebase.database().ref("/events")
        var newChildRef = ref.push();
        newChildRef.set({
          "page": pageID,
          "time": Date.now(),
          "action": action
        });

        // Track IP data on download
        trackIPData(action);

      } catch (e) {
        console.error(e);

      }
    }

    async function viewJsonInNewTab() {

      let ios = null;
      let android = null;

      try {
        const snapshot = await firebase.database().ref("/more_details/ios/" + pageID).once("value");
        const jsonString = snapshot.val();
        if (jsonString) {
          ios = JSON.parse(jsonString);
        }
      } catch (e) {
        console.error("Error fetching iOS data:", e);
      }

      try {
        const snapshot = await firebase.database().ref("/more_details/android/" + pageID).once("value");
        const jsonString = snapshot.val();
        if (jsonString) {
          android = JSON.parse(jsonString);
        }
      } catch (e) {
        console.error("Error fetching Android data:", e);
      }

      localStorage.removeItem("hd_time");
      localStorage.removeItem("jsonStore_1");
      localStorage.removeItem("jsonStore_2");
      if (android != null)
        localStorage.setItem("jsonStore_2", encodeURIComponent(JSON.stringify(android, null, 2)));
      if (ios != null)
        localStorage.setItem("jsonStore_1", encodeURIComponent(JSON.stringify(ios, null, 2)));
      localStorage.setItem("g_app_name_for_url", g_app_name_for_url);
      // Open in same tab
      window.location.href = `more_info.html`;

    }


    function clearElementContent(elementId) {
      try {
        const element = document.getElementById(elementId);
        if (element) {
          while (element.firstChild) {
            element.removeChild(element.firstChild);
          }
        }
      }
      catch (e) {

      }

    }


    function getSafeDataDupRemoved(data, name) {
      var iosData = null;
      var androidData = null;
      try { iosData = data["ios"][name] } catch (e) { console.error(e); }
      try { androidData = data["android"][name] } catch (e) { console.error(e); }
      if (iosData !== null && androidData !== null && iosData !== androidData) {
        return `${iosData} | ${androidData}`;
      } else if (iosData !== null) {
        return iosData;
      } else if (androidData !== null && iosData == null) {
        return androidData;
      }
      return null;
    }

    function formatDate(date) {
      const months = ['January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'];
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

      const day = date.getDate();
      const month = months[date.getMonth()];
      const year = date.getFullYear();
      const weekday = days[date.getDay()];

      return `${day} ${month} ${year}, ${weekday}`;
    }

    function getSafeDateTime(data, name) {

      var iosData = null;
      var androidData = null;
      try { iosData = formatDate(new Date(data["ios"][name])); } catch (e) { console.error(e); }
      try { androidData = formatDate(new Date(data["android"][name])); } catch (e) { console.error(e); }
      if (androidData !== null && deviceType == 1) {
        return androidData;
      }
      if (iosData !== null) {
        return iosData;
      }
      return androidData;
    }


    function getSafeDataIosFirst(data, name) {
      var iosData = null;
      var androidData = null;
      try { iosData = data["ios"][name] } catch (e) { console.error(e); }
      try { androidData = data["android"][name] } catch (e) { console.error(e); }
      if (deviceType == 1) {
        if (androidData !== null) {
          return androidData;
        } else return iosData;
      }
      if (iosData !== null) {
        return iosData;
      } else return androidData;
    }

    function hasDataOn(data, name, platform) {
      try {
        const cData = data[platform]?.[name];
        return typeof cData === "string" && cData.trim() !== "";
      } catch (e) {
        console.error(e);
        return false;
      }
    }



    function setData(data) {
      // Change background from transparent to solid after loading
      document.getElementById('message').style.background = '#2d2d2d';

      g_app_name_for_url = getSafeDataIosFirst(data, "g_app_name_for_url");
      appid.textContent = getSafeDataIosFirst(data, "name");
      var div = document.createElement('div')
      div.innerHTML = `<span style="color: rgba(255, 255, 255, 0.87); text-align: left; width: 100%; font-weight: 100; font-size: 14px;">${getSafeDataIosFirst(data, "packageName")}</span>`
      clearElementContent('result_list_packageName')
      document.getElementById('result_list_packageName').appendChild(div)
      document.getElementById("infoButton").style.display = "inline";
      div = document.createElement('div')
      div.innerHTML = `<span style="color: rgba(255, 255, 255, 0.87); text-align: left; width: 100%; font-weight: 400; font-size: 14px;">Version: ${getSafeDataIosFirst(data, "versionName")}</span>`
      clearElementContent('result_list_versionName')
      document.getElementById('result_list_versionName').appendChild(div)
      div = document.createElement('div')
      div.innerHTML = `<span style="color: rgba(255, 255, 255, 0.87); text-align: left; width: 100%; font-weight: 100; font-size: 14px;">Uploaded: ${getSafeDateTime(data, "date")}</span>`
      clearElementContent('result_list_date')
      document.getElementById('result_list_date').appendChild(div)
      div = document.createElement('div')

      var imagedata = getSafeDataIosFirst(data, "icon");
      if (imagedata == null || imagedata === "") {
        if (data && data.ios && data.ios.icon) {
          imagedata = data.ios.icon;
        }
      }
      if (imagedata == null || imagedata === "") {
        if (data && data.android && data.android.icon) {
          imagedata = data.android.icon;
        }
      }
      if (imagedata != null && imagedata !== "") {
        div.innerHTML = `<img src="${imagedata}" class="centerIMG">`;
      }

      clearElementContent('result_div_icon')
      document.getElementById('result_div_icon').appendChild(div)
      // iOS Download Button
      if (deviceType == 2) {
        // iOS device - show iOS button if available, otherwise show Android as gray
        if (hasDataOn(data, "plist", "ios")) {
          var linkkkk = "itms-services://?action=download-manifest&url=";
          let encoded = encodeURIComponent(data["ios"]["plist"]);
          const div = document.createElement('div')
          div.innerHTML = `<a onClick="download1(\'${linkkkk + encoded}\',\'download_plist\')" class="btn"><i class="fa fa-apple" style="font-size:18px;color:white" ></i>  Download</a>`
          clearElementContent('result_list_ios')
          document.getElementById('result_list_ios').appendChild(div)
        } else if (hasDataOn(data, "apk", "android")) {
          const div = document.createElement('div')
          div.innerHTML = `<a class="btn" style="background-color: gray; cursor: not-allowed;"><i class="fa fa-android" style="font-size:18px;color:white" ></i>  Download (Android)</a>`
          clearElementContent('result_list_ios')
          document.getElementById('result_list_ios').appendChild(div)
        }
      } else if (deviceType == 0) {
        // PC - show both buttons
        if (hasDataOn(data, "ipa", "ios")) {
          const div = document.createElement('div')
          div.innerHTML = `<a onClick="download1(\'${data["ios"]["ipa"]}\',\'download_ipa\')" class="btn"><i class="fa fa-apple" style="font-size:18px;color:white" ></i>  Download iOS</a>`
          clearElementContent('result_list_ios')
          document.getElementById('result_list_ios').appendChild(div)
        }
        if (hasDataOn(data, "apk", "android")) {
          const div = document.createElement('div')
          div.innerHTML = `<a onClick="download1(\'${data["android"]["apk"]}\',\'download_apk\')" class="btn" style="margin-top: 10px;"><i class="fa fa-android" style="font-size:18px;color:white" ></i>  Download Android</a>`
          clearElementContent('result_list_android')
          document.getElementById('result_list_android').appendChild(div)
        }
      } else if (deviceType == 1) {
        // Android device - show Android button if available, otherwise show iOS as gray
        if (hasDataOn(data, "apk", "android")) {
          const div = document.createElement('div')
          div.innerHTML = `<a onClick="download1(\'${data["android"]["apk"]}\',\'download_apk\')" class="btn"><i class="fa fa-android" style="font-size:18px;color:white" ></i>  Download</a>`
          clearElementContent('result_list_android')
          document.getElementById('result_list_android').appendChild(div)
        } else if (hasDataOn(data, "ipa", "ios") || hasDataOn(data, "plist", "ios")) {
          const div = document.createElement('div')
          div.innerHTML = `<a class="btn" style="background-color: gray; cursor: not-allowed;"><i class="fa fa-apple" style="font-size:18px;color:white" ></i>  Download (iOS)</a>`
          clearElementContent('result_list_android')
          document.getElementById('result_list_android').appendChild(div)
        }
      }
      if (deviceType == 0 || true) {
        clearElementContent('qrcode');
        const isMobile = window.innerWidth <= 600;
        const qrSize = isMobile ? 150 : 200;
        const qrcode = new QRCode(document.getElementById('qrcode'), {
          text: window.location.toString(),
          width: qrSize,
          height: qrSize,
          colorDark: '#fff',
          colorLight: '#2d2d2d',
          correctLevel: QRCode.CorrectLevel.H
        });
        const qrText = document.querySelector('#qrText');
        if (deviceType == 0) {
          qrText.textContent = "scan QR code to install in your phone";
        } else {
          qrText.textContent = "";
        }
      }
    }

    async function checkFirebaseStorageAccess() {
      try {
        const response = await fetch("https://firebasestorage.googleapis.com/v0/b/install4.appspot.com/o/");
        if (!response.ok) {
          return false;
        }
        const data = await response.json();
        return data.items && data.items.length > 0;
      } catch (error) {
        console.error("Firebase Storage access check failed:", error);
        return false;
      }
    }

    async function fetchData() {
      const currentTime = Date.now();
      if (currentTime - lastFetchTime < COOLDOWN_PERIOD) {
        return;
      }
      lastFetchTime = currentTime;
      appid.textContent = getRandomLoadingWord();
      // Make background transparent during loading
      document.getElementById('message').style.background = 'transparent';



      let extractedPageID = null;
      try {
        const str = pageID; // assuming pageID contains something like "halha_2______halha_qa__2025_04_25_135430"
        const parts = str.split('______');
        if (parts.length > 1) {
          const secondParts = parts[1].split('__');
          if (secondParts.length > 0) {
            const result = secondParts[0];
            if (result && result.trim() !== '') {
              extractedPageID = result; // "halha_qa"
            }
          }
        }

      } catch (error) {
        console.error('Error:', error);
      }




      const paths = ["/app_links/" + pageID, ("/app_links_all/" + pageID).replace("____", "/")];

      if (extractedPageID) {
        paths.push("/app_links/" + extractedPageID);
      }

      for (const path of paths) {
        //  console.log(path)
        try {
          const snapshot = await firebase.database().ref(path).get();
          if (snapshot.exists()) {
            let data = {};
            snapshot.forEach(function (childSnapshot) {
              var childKey = childSnapshot.key;
              var childData = childSnapshot.val();
              data[childKey] = childData;
            });
            //  console.log(path)
            // console.log(data)
            if (hasDataOn(data, "ipa", "ios") || hasDataOn(data, "apk", "android")) {
              setData(data)
              document.getElementById("upload").style.visibility = 'visible';
              return
            }
          }
        } catch (error) {
          console.error(`Error fetching data from ${path + pageID}:`, error);
        }
      }

      appid.textContent = "404 Not Found";
      // Keep background transparent for 404
      document.getElementById('message').style.background = 'transparent';

    }


  </script>
</body>

</html>